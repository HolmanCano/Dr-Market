<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Mockup de Camiseta</title>
<style>
  body {font-family: system-ui, sans-serif; background:#f4f6f8; margin:0; padding:20px; display:flex; flex-direction:column; align-items:center;}
  h1 {font-size:20px;}
  canvas {background:#fff; border-radius:10px; box-shadow:0 0 10px rgba(0,0,0,0.1);}
  .panel {margin-top:15px; display:flex; flex-wrap:wrap; gap:10px; justify-content:center;}
  button, select, input[type=range] {
    padding:8px 12px; border-radius:8px; border:1px solid #ccc; background:white;
    cursor:pointer; font-size:14px;
  }
  button:hover {background:#0b66ff; color:white; border-color:#0b66ff;}
  label {display:block; font-size:13px; margin-top:10px;}
  .control-group {max-width:400px; margin-top:15px;}
  .cart-fab {position:fixed; top:12px; right:12px; background:#0b66ff; color:#fff; text-decoration:none; padding:8px 12px; border-radius:8px; display:inline-flex; align-items:center; gap:8px;}
  .cart-fab .cart-icon {width:20px; height:20px; display:inline-flex; align-items:center; justify-content:center;}
  .cart-fab .cart-icon svg {width:100%; height:100%; fill:currentColor;}
  .cart-fab .cart-count {min-width:24px; padding:2px 8px; border-radius:999px; background:rgba(255,255,255,0.2); font-size:13px; line-height:1;}
</style>
</head>
<body>
<a class="cart-fab" href="carrito.html">
  <span class="cart-icon" aria-hidden="true">
    <svg viewBox="0 0 24 24" focusable="false">
      <path d="M7.75 20a1.75 1.75 0 1 1 0-3.5 1.75 1.75 0 0 1 0 3.5Zm8.5 0a1.75 1.75 0 1 1 0-3.5 1.75 1.75 0 0 1 0 3.5ZM4.25 4.5h-1.5V3h2.1a1.25 1.25 0 0 1 1.2.9l.36 1.3H21.5a.75.75 0 0 1 .72.96l-2 7.25a1.75 1.75 0 0 1-1.68 1.29H9.24l-.37 1.36h11.63v1.5H7.59a1.25 1.25 0 0 1-1.2-1.6l1.02-3.76-2.22-8.2Z"/>
    </svg>
  </span>
  <span class="cart-text">Carrito</span>
  <span class="cart-count" id="cart-count" aria-live="polite">0</span>
</a>
<h1>Mockup Interactivo de Camiseta Blanca</h1>

<canvas id="mockup" width="600" height="800"></canvas>

<div class="panel">
  <label>Zona de estampado:</label>
  <select id="zona">
    <option value="pecho">Centro del pecho</option>
    <option value="logo">Logo pequeÃ±o (superior)</option>
    <option value="frontal">Frontal completo</option>
  </select>

  <label>Subir imagen:</label>
  <input type="file" id="fileImg" accept="image/*">

  <button id="fit">Ajustar dentro</button>
  <button id="center">Centrar</button>
  <button id="download">Descargar mockup</button>
</div>

<div class="control-group">
  <label>Escala</label>
  <input type="range" id="scale" min="0.1" max="3" step="0.01" value="1">
  <label>RotaciÃ³n</label>
  <input type="range" id="rotate" min="-180" max="180" step="1" value="0">
  <label>Opacidad</label>
  <input type="range" id="opacity" min="0" max="1" step="0.01" value="1">
</div>

<script>
const canvas = document.getElementById("mockup");
const ctx = canvas.getContext("2d");

const fileInput = document.getElementById("fileImg");
const zonaSelect = document.getElementById("zona");
const scaleInput = document.getElementById("scale");
const rotateInput = document.getElementById("rotate");
const opacityInput = document.getElementById("opacity");
const fitBtn = document.getElementById("fit");
const centerBtn = document.getElementById("center");
const downloadBtn = document.getElementById("download");

// Cargar plantilla fija
const plantilla = new Image();
plantilla.src = "shirt-white.png"; // asegÃºrate de que estÃ© en la misma carpeta
let plantillaCargada = false;
plantilla.onload = () => {
  plantillaCargada = true;
  render();
};

// Configuraciones de Ã¡reas
const areas = {
  pecho: {x: 150, y: 250, w: 300, h: 300},
  logo: {x: 230, y: 180, w: 140, h: 120},
  frontal: {x: 120, y: 200, w: 360, h: 480}
};

let printArea = {...areas.pecho};

let img = new Image();
let imgLoaded = false;
let imgState = {x: printArea.x + printArea.w/2, y: printArea.y + printArea.h/2, scale:1, rot:0, opacity:1};

function render(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  if(plantillaCargada) ctx.drawImage(plantilla,0,0,canvas.width,canvas.height);
  drawGuide();
  drawImage();
}

function drawGuide(){
  ctx.save();
  ctx.strokeStyle="rgba(0,0,0,0.2)";
  ctx.lineWidth=2;
  ctx.setLineDash([6,6]);
  ctx.strokeRect(printArea.x, printArea.y, printArea.w, printArea.h);
  ctx.restore();
}

function drawImage(){
  if(!imgLoaded) return;
  ctx.save();
  roundClip(ctx, printArea.x, printArea.y, printArea.w, printArea.h, 8);
  ctx.translate(imgState.x, imgState.y);
  ctx.rotate(imgState.rot*Math.PI/180);
  ctx.globalAlpha = imgState.opacity;
  ctx.drawImage(img, -(img.width*imgState.scale)/2, -(img.height*imgState.scale)/2, img.width*imgState.scale, img.height*imgState.scale);
  ctx.globalAlpha = 1;
  ctx.restore();
}

function roundClip(ctx,x,y,w,h,r){
  ctx.beginPath();
  ctx.moveTo(x+r,y);
  ctx.arcTo(x+w,y,x+w,y+h,r);
  ctx.arcTo(x+w,y+h,x,y+h,r);
  ctx.arcTo(x,y+h,x,y,r);
  ctx.arcTo(x,y,x+w,y,r);
  ctx.closePath();
  ctx.clip();
}

// Subir imagen
fileInput.addEventListener("change", e=>{
  const f = e.target.files[0];
  if(!f) return;
  const url = URL.createObjectURL(f);
  img = new Image();
  img.onload = ()=>{
    imgLoaded = true;
    fitImage();
    URL.revokeObjectURL(url);
  };
  img.src = url;
});

function fitImage(){
  imgState.scale = Math.min(printArea.w / img.width, printArea.h / img.height)*0.95;
  imgState.x = printArea.x + printArea.w/2;
  imgState.y = printArea.y + printArea.h/2;
  render();
}

// Cambiar zona
zonaSelect.addEventListener("change", ()=>{
  printArea = {...areas[zonaSelect.value]};
  imgState.x = printArea.x + printArea.w/2;
  imgState.y = printArea.y + printArea.h/2;
  render();
});

// Controles
scaleInput.addEventListener("input", ()=>{imgState.scale = Number(scaleInput.value); render();});
rotateInput.addEventListener("input", ()=>{imgState.rot = Number(rotateInput.value); render();});
opacityInput.addEventListener("input", ()=>{imgState.opacity = Number(opacityInput.value); render();});
fitBtn.addEventListener("click", ()=>{fitImage();});
centerBtn.addEventListener("click", ()=>{
  imgState.x = printArea.x + printArea.w/2;
  imgState.y = printArea.y + printArea.h/2;
  render();
});

// Descargar
downloadBtn.addEventListener("click", ()=>{
  const link = document.createElement("a");
  link.download = "mockup_camiseta.png";
  link.href = canvas.toDataURL("image/png");
  link.click();
});

// Movimiento con el ratÃ³n
let dragging=false, dragStart=null;
canvas.addEventListener("mousedown", e=>{
  if(!imgLoaded) return;
  const pos = getMousePos(e);
  if(pointInRect(pos,printArea)){dragging=true; dragStart={x:pos.x-imgState.x,y:pos.y-imgState.y};}
});
window.addEventListener("mousemove", e=>{
  if(!dragging) return;
  const pos = getMousePos(e);
  imgState.x = pos.x - dragStart.x;
  imgState.y = pos.y - dragStart.y;
  render();
});
window.addEventListener("mouseup", ()=>{dragging=false; dragStart=null;});

function getMousePos(evt){
  const rect = canvas.getBoundingClientRect();
  return {x:(evt.clientX-rect.left)*(canvas.width/rect.width), y:(evt.clientY-rect.top)*(canvas.height/rect.height)};
}
function pointInRect(p, rect){return p.x>=rect.x && p.x<=rect.x+rect.w && p.y>=rect.y && p.y<=rect.y+rect.h;}

render();
</script>
    <script src="js/cart.js"></script>
</body>
</html>


